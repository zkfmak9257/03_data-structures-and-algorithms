name: Auto Merge Open Pull Requests

on:
  workflow_dispatch: # 수동 실행

jobs:
  merge_all_prs:
    runs-on: ubuntu-latest

    # 기본적인 권한 설정
    permissions:
      contents: write
      pull-requests: write

    steps:
      # 1. 코드 체크아웃 (저장소의 모든 파일을 가져옴)
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. 스크립트 실행 (경로 수정됨)
      - name: Run Auto Merge Script
        env:
          # Settings > Secrets and variables > Actions에 저장한 토큰 이름
          GH_TOKEN: ${{ secrets.GH_ADMIN_TOKEN }}
        run: |
          echo "Setting permissions for script..."
          # 파일이 위치한 정확한 경로를 지정해 권한 부여
          chmod +x .github/workflows/merge_prs.sh
          
          echo "Executing script..."
          # 파일이 위치한 정확한 경로로 실행
          ./.github/workflows/merge_prs.sh
